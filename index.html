<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mistral Chat</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #0d0d0d, #1c1c1c);
      color: #f0f0f0;
    }

    .header, .footer {
      background: #111;
      padding: 15px;
      text-align: center;
    }

    .header h1 {
      color: #00bfff;
      margin: 0;
    }

    .container {
      max-width: 800px;
      margin: 20px auto;
      background: #222;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 15px #000;
    }

    .chat-box {
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      background: #000;
      padding: 15px;
      border-radius: 8px;
    }

    .user { color: #0f0; }
    .bot { color: #0af; margin-bottom: 10px; }

    label, select, textarea, input {
      display: block;
      width: 100%;
      margin-top: 10px;
      background: #333;
      border: 1px solid #444;
      color: #fff;
      padding: 10px;
      border-radius: 6px;
    }

    button {
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      background: #00bfff;
      border: none;
      color: #fff;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #0099cc;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 20px;
    }

    .language-select {
      margin-top: 20px;
    }

    .confirmation {
      background: #111;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .confirmation button {
      width: auto;
      margin: 10px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 id="title">üí¨ –ß–∞—Ç —Å Mistral</h1>
  </div>

  <div class="container" id="mainPage">
    <label id="labelApiKey">üîë API-–∫–ª—é—á:</label>
    <input type="password" id="apiKey" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π –∫–ª—é—á">

    <label id="labelMessage">üí¨ –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
    <textarea id="userInput" rows="3" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å..."></textarea>

    <div class="language-select">
      <label id="labelLanguage">üåê –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:</label>
      <select id="languageSelect" onchange="changeLanguage()">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="en">English</option>
        <option value="es">Espa√±ol</option>
      </select>
    </div>

    <button onclick="startChat()">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥</button>
  </div>

  <div class="container hidden" id="chatPage">
    <div class="chat-box" id="chatBox">
      <p><i>üí¨ –ß–∞—Ç –Ω–∞—á–∞—Ç. –í–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.</i></p>
    </div>

    <textarea id="chatInput" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
    <button onclick="sendMessage()">‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

    <div class="controls">
      <button onclick="newDialog()">üîÑ –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥</button>
      <button onclick="confirmExit()">üö™ –í—ã–π—Ç–∏</button>
    </div>
  </div>

  <div class="container hidden" id="confirmExitBox">
    <div class="confirmation">
      <p id="exitConfirmText">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞?</p>
      <button onclick="exitChat()">–î–∞</button>
      <button onclick="cancelExit()">–ù–µ—Ç</button>
    </div>
  </div>

  <div class="footer">
    <p>&copy; 2025 Mistral Chat UI</p>
  </div>

  <script>
    const translations = {
      ru: {
        title: "üí¨ –ß–∞—Ç —Å Mistral",
        labelApiKey: "üîë API-–∫–ª—é—á:",
        labelMessage: "üí¨ –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:",
        labelLanguage: "üåê –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:",
        exitConfirmText: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞?",
        placeholderInput: "–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å...",
        send: "‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å",
        start: "‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥",
        newDialog: "üîÑ –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥",
        exit: "üö™ –í—ã–π—Ç–∏",
        thinking: "ü§ñ –ë–æ—Ç –¥—É–º–∞–µ—Ç..."
      },
      en: {
        title: "üí¨ Chat with Mistral",
        labelApiKey: "üîë API Key:",
        labelMessage: "üí¨ Your Message:",
        labelLanguage: "üåê Interface Language:",
        exitConfirmText: "Are you sure you want to exit the dialog?",
        placeholderInput: "Write something...",
        send: "‚úâÔ∏è Send",
        start: "‚ñ∂Ô∏è Start Chat",
        newDialog: "üîÑ New Dialog",
        exit: "üö™ Exit",
        thinking: "ü§ñ Bot is thinking..."
      },
      es: {
        title: "üí¨ Chat con Mistral",
        labelApiKey: "üîë Clave API:",
        labelMessage: "üí¨ Tu mensaje:",
        labelLanguage: "üåê Idioma de interfaz:",
        exitConfirmText: "¬øSeguro que quieres salir del di√°logo?",
        placeholderInput: "Escribe algo...",
        send: "‚úâÔ∏è Enviar",
        start: "‚ñ∂Ô∏è Iniciar Chat",
        newDialog: "üîÑ Nuevo di√°logo",
        exit: "üö™ Salir",
        thinking: "ü§ñ El bot est√° pensando..."
      }
    };

    function changeLanguage() {
      const lang = document.getElementById('languageSelect').value;
      const t = translations[lang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('labelApiKey').textContent = t.labelApiKey;
      document.getElementById('labelMessage').textContent = t.labelMessage;
      document.getElementById('labelLanguage').textContent = t.labelLanguage;
      document.getElementById('exitConfirmText').textContent = t.exitConfirmText;
      document.getElementById('userInput').placeholder = t.placeholderInput;
      document.getElementById('chatInput').placeholder = t.placeholderInput;
      document.querySelector('button[onclick=\"startChat()\"]').textContent = t.start;
      document.querySelector('button[onclick=\"sendMessage()\"]').textContent = t.send;
      document.querySelector('button[onclick=\"newDialog()\"]').textContent = t.newDialog;
      document.querySelector('button[onclick=\"confirmExit()\"]').textContent = t.exit;
    }

    function startChat() {
      const key = document.getElementById('apiKey').value.trim();
      const input = document.getElementById('userInput').value.trim();
      if (!key || !input) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
      window.apiKey = key;

      document.getElementById('mainPage').classList.add('hidden');
      document.getElementById('chatPage').classList.remove('hidden');

      document.getElementById('chatBox').innerHTML = `<p>üë§ <span class="user">${input}</span></p>`;
      sendMessage(input);
    }

    async function sendMessage(initialMsg = null) {
      const chatInput = document.getElementById('chatInput');
      const message = initialMsg || chatInput.value.trim();
      if (!message) return;

      const chatBox = document.getElementById('chatBox');
      chatBox.innerHTML += `<p>üë§ <span class="user">${message}</span></p>`;
      chatBox.innerHTML += `<p><i>${translations[getLang()].thinking}</i></p>`;
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const response = await fetch("https://api.mistral.ai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${window.apiKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "mistral-small-latest",
            messages: [{ role: "user", content: message }],
            temperature: 0.7
          })
        });

        const data = await response.json();
        const reply = data?.choices?.[0]?.message?.content || "‚ö†Ô∏è –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞.";
        chatBox.innerHTML = chatBox.innerHTML.replace(`<p><i>${translations[getLang()].thinking}</i></p>`, '');
        chatBox.innerHTML += `<p>ü§ñ <span class="bot">${reply}</span></p>`;
        chatBox.scrollTop = chatBox.scrollHeight;
        chatInput.value = '';
      } catch (err) {
        chatBox.innerHTML += `<p><span class="bot">–û—à–∏–±–∫–∞: ${err.message}</span></p>`;
      }
    }

    function newDialog() {
      document.getElementById('chatInput').value = '';
      document.getElementById('chatBox').innerHTML = '<p><i>üí¨ –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ –Ω–∞—á–∞—Ç.</i></p>';
    }

    function confirmExit() {
      document.getElementById('chatPage').classList.add('hidden');
      document.getElementById('confirmExitBox').classList.remove('hidden');
    }

    function cancelExit() {
      document.getElementById('confirmExitBox').classList.add('hidden');
      document.getElementById('chatPage').classList.remove('hidden');
    }

    function exitChat() {
      document.getElementById('confirmExitBox').classList.add('hidden');
      document.getElementById('mainPage').classList.remove('hidden');
    }

    function getLang() {
      return document.getElementById('languageSelect').value;
    }

    window.onload = () => changeLanguage();
  </script>
</body>
</html>
